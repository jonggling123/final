<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ddit.finalproject.team2.myPack.dao.LSY_QuizDAO">
	
	<resultMap type="ddit.finalproject.team2.vo.Lsy_QuizQuestionVO" id="allQ" autoMapping="true">
			<id property="question_no" column="QUESTION_NO"/>
		<collection property="problemList" autoMapping="true" ofType="ddit.finalproject.team2.vo.Lsy_QuizProblemVo">
			<id property="quizProblem_no" column="QUIZPROBLEM_NO"/>
		</collection>
	</resultMap>
	
	<insert id="insertQuiz" parameterType="ddit.finalproject.team2.vo.Lsy_EmbraceQuizVo">
		INSERT ALL
			<foreach collection="quizList" item="quiz">
			into QUIZQUESTION
				( QUESTION_NO, QUESTION_CONTENT, QUESTION_ANSWER, CLASS_IDENTIFYING_CODE, LECTURE_CODE ) 
			values
					(
					#{quiz.question_no}, #{quiz.question_content}, 
					#{quiz.question_answer}, #{quiz.class_identifying_code},
					#{quiz.lecture_code}
					)
				<foreach collection="quiz.problemList" item="problem">
					into QUIZPROBLEM
						( quizProblem_no, quizProblem_content, question_no )
					values
				 		(
						#{problem.quizProblem_no}, #{problem.quizProblem_content}, 
						#{problem.question_no}
						)
				</foreach>
			</foreach>
		select * from dual
	</insert>
	
	<update id="updateQuiz" parameterType="ddit.finalproject.team2.vo.Lsy_QuizQuestionVO">
		update 
		(select q.question_no, q.question_content, q.question_answer, q.class_identifying_code, q.lecture_code
        from quizquestion q where q.lecture_code = #{lecture_code}
        					and q.class_identifying_code = #{class_identifying_code}) qn
		set qn.question_content = #{question_content},
		    qn.question_answer = #{question_answer},
		    qn.class_identifying_code = #{class_identifying_code}
		where qn.question_no = {question_no} and qn.class_identifying_code= #{class_identifying_code};
	</update>
	
<!-- 	<insert id="insertProblem" parameterType="ddit.finalproject.team2.vo.EmbraceProblemListVo"> -->
<!-- 		INSERT ALL -->
<!-- 			<foreach collection="problemList" item="problem"> -->
<!-- 			into QUIZPROBLEM -->
<!-- 				( quizProblem_no, quizProblem_content, question_no ) -->
<!-- 			values -->
<!-- 			 		( -->
<!-- 					#{problem.quizProblem_no}, #{problem.quizProblem_content},  -->
<!-- 					#{problem.question_no} -->
<!-- 					) -->
<!-- 			</foreach> -->
<!-- 		select * from dual -->
<!-- 	</insert> -->
	
	<delete id="deleteProblem">
		delete from 
		where
	</delete>
	
	<select id="selectOneQuiz" parameterType="String" resultMap="allQ">
		select
		   qn.question_no, qn.question_content, qn.question_answer, qn.class_identifying_code,
		   qn.lecture_code,
		   p.quizproblem_no, p.quizproblem_content, p.question_no
		from quizproblem p,
			(select q.question_no, q.question_content, q.question_answer, q.class_identifying_code, q.lecture_code
			from quizquestion q where q.lecture_code = 'lecture_code_1'
								and q.class_identifying_code = #{code}) qn
		where p.question_no = qn.question_no
	</select>
</mapper>

